function calculateMultipleDesigns(rollWidth, designs, allowRotation) {
            if (!designs || designs.length === 0) {
                return null;
            }
            
            let sections = [];
            let totalLength = 0;
            let totalUsedArea = 0;
            let totalConsumedArea = 0;
            
            designs.forEach(design => {
                // Calculate for normal orientation
                const designsPerRowNormal = Math.floor(rollWidth / design.width);
                const materialPerDesignNormal = designsPerRowNormal > 0 ? (rollWidth * design.height) / designsPerRowNormal : 999999;
                
                // Calculate for rotated orientation
                const designsPerRowRotated = allowRotation ? Math.floor(rollWidth / design.height) : 0;
                const materialPerDesignRotated = designsPerRowRotated > 0 ? (rollWidth * design.width) / designsPerRowRotated : 999999;
                
                // Choose best orientation
                const bestOrientation = materialPerDesignNormal <= materialPerDesignRotated ? 'NORMAL' : 'ROTATED';
                const optimalDesignsPerRow = bestOrientation === 'NORMAL' ? designsPerRowNormal : designsPerRowRotated;
                const rowHeight = bestOrientation === 'NORMAL' ? design.height : design.width;
                const designWidthInLayout = bestOrientation === 'NORMAL' ? design.width : design.height;
                
                const rowsNeeded = Math.ceil(design.quantity / optimalDesignsPerRow);
                const sectionLength = rowsNeeded * rowHeight;
                const sectionUsedArea = design.quantity * design.width * design.height;
                const sectionConsumedArea = rollWidth * sectionLength;
                
                sections.push({
                    design: design,
                    bestOrientation: bestOrientation,
                    designsPerRow: optimalDesignsPerRow,
                    rowsNeeded: rowsNeeded,
                    rowHeight: rowHeight,
                    sectionLength: sectionLength,
                    usedArea: sectionUsedArea,
                    consumedArea: sectionConsumedArea,
                    wastage: (sectionConsumedArea - sectionUsedArea) / sectionConsumedArea,
                    totalDesigns: design.quantity,
                    scaledDesignWidth: designWidthInLayout,
                    scaledRowHeight: rowHeight
                });
                
                totalLength += sectionLength;
                totalUsedArea += sectionUsedArea;
                totalConsumedArea += sectionConsumedArea;
            });
            
            const overallWastage = (totalConsumedArea - totalUsedArea) / totalConsumedArea;
            
            return {
                sections: sections,
                totalLength: totalLength,
                totalUs<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Canvas Print Calculator</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --bg-black: #000000;
            --text-white: #ffffff;
            --text-gray: #666666;
            --text-dark-gray: #333333;
            --accent-red: #cc0000;
            --accent-green: #00cc00;
            --border-gray: #222222;
            --input-bg: #111111;
            --hover-bg: #1a1a1a;
        }
        
        body {
            font-family: 'Courier Prime', monospace;
            background: var(--bg-black);
            color: var(--text-white);
            font-size: 12px;
            line-height: 1.3;
            min-height: 100vh;
        }
        
        .terminal {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .header {
            background: var(--bg-black);
            border-bottom: 1px solid var(--border-gray);
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
        }
        
        .header-left {
            color: var(--text-white);
            font-weight: bold;
        }
        
        .header-right {
            color: var(--text-gray);
            display: flex;
            gap: 16px;
        }
        
        .status-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            background: var(--accent-green);
            border-radius: 50%;
            margin-right: 6px;
        }
        
        .container {
            flex: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-template-rows: auto auto;
            gap: 20px;
        }
        
        .panel {
            background: var(--bg-black);
            border: 1px solid var(--border-gray);
            padding: 16px;
            transition: border-color 0.2s ease;
        }
        
        .panel:hover {
            border-color: var(--text-dark-gray);
        }
        
        .panel-title {
            color: var(--text-white);
            font-weight: bold;
            font-size: 11px;
            margin-bottom: 16px;
            text-transform: uppercase;
            border-bottom: 1px solid var(--border-gray);
            padding-bottom: 4px;
        }
        
        .input-group {
            margin-bottom: 12px;
        }
        
        .input-label {
            display: block;
            color: var(--text-gray);
            font-size: 10px;
            margin-bottom: 4px;
            text-transform: uppercase;
        }
        
        .input-field {
            width: 100%;
            background: var(--input-bg);
            border: 1px solid var(--border-gray);
            color: var(--text-white);
            padding: 8px;
            font-family: 'Courier Prime', monospace;
            font-size: 11px;
            transition: border-color 0.2s ease;
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--accent-red);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox {
            width: 16px;
            height: 16px;
            background: var(--input-bg);
            border: 1px solid var(--border-gray);
            cursor: pointer;
            position: relative;
        }
        
        .checkbox.checked::after {
            content: 'âœ“';
            position: absolute;
            top: -2px;
            left: 2px;
            color: var(--accent-green);
            font-size: 12px;
        }
        
        .calculate-btn {
            width: 100%;
            background: var(--accent-red);
            color: var(--text-white);
            border: none;
            padding: 12px;
            font-family: 'Courier Prime', monospace;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            transition: background-color 0.2s ease;
            margin-top: 16px;
        }
        
        .calculate-btn:hover {
            background: #990000;
        }
        
        .result-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 4px 0;
            border-bottom: 1px solid var(--border-gray);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .result-row:hover {
            background: var(--hover-bg);
        }
        
        .result-label {
            color: var(--text-gray);
            font-size: 10px;
            text-transform: uppercase;
        }
        
        .result-value {
            color: var(--text-white);
            font-weight: bold;
            font-size: 11px;
        }
        
        .result-value.highlight {
            color: var(--accent-green);
        }
        
        .copy-feedback {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--accent-green);
            color: var(--bg-black);
            padding: 8px 16px;
            font-size: 10px;
            font-weight: bold;
            text-transform: uppercase;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
        }
        
        .copy-feedback.show {
            opacity: 1;
        }
        
        .results-grid {
            display: none;
        }
        
        .footer {
            background: var(--bg-black);
            border-top: 1px solid var(--border-gray);
            padding: 6px 16px;
            display: flex;
            justify-content: space-between;
            font-size: 9px;
            color: var(--text-gray);
        }
        
        .design-row {
            display: grid;
            grid-template-columns: 1fr 1fr 60px 60px 40px;
            gap: 6px;
            margin-bottom: 8px;
            padding: 8px;
            background: var(--input-bg);
            border: 1px solid var(--border-gray);
            align-items: center;
        }
        
        .design-row input, .design-row select {
            font-size: 10px;
            padding: 4px 6px;
        }
        
        .remove-btn {
            background: var(--accent-red);
            color: var(--text-white);
            border: none;
            padding: 4px;
            font-size: 8px;
            cursor: pointer;
            text-align: center;
        }
        
        .remove-btn:hover {
            background: #990000;
        }
        
        .design-summary {
            font-size: 9px;
            color: var(--text-gray);
            margin-top: 4px;
        }
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto auto;
                padding: 10px;
            }
        }
        
        .section-separator {
            display: none;
        }
    </style>
</head>
<body>
    <div class="terminal">
        <div class="header">
            <div class="header-left">CANVAS PRINT CALCULATOR</div>
            <div class="header-right">
                <span><span class="status-dot"></span>ONLINE</span>
                <span id="current-time">14:30 GMT</span>
                <span id="current-date">27-JUN-2025</span>
            </div>
        </div>
        
        <div class="container">
            <!-- Layout Optimizer Section -->
            <div class="panel">
                <div class="panel-title">Layout Optimizer</div>
                
                <div class="input-group">
                    <label class="input-label">Roll Width</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="number" class="input-field" id="rollWidth" value="60" step="0.1" style="flex: 1;">
                        <select class="input-field" id="rollWidthUnit" style="width: 80px;">
                            <option value="inch">INCH</option>
                            <option value="ft">FT</option>
                            <option value="cm">CM</option>
                            <option value="mtr">MTR</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">Design Width</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="number" class="input-field" id="designWidth" value="16" step="0.1" style="flex: 1;">
                        <select class="input-field" id="designWidthUnit" style="width: 80px;">
                            <option value="inch">INCH</option>
                            <option value="ft">FT</option>
                            <option value="cm">CM</option>
                            <option value="mtr">MTR</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">Design Height</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="number" class="input-field" id="designHeight" value="20" step="0.1" style="flex: 1;">
                        <select class="input-field" id="designHeightUnit" style="width: 80px;">
                            <option value="inch">INCH</option>
                            <option value="ft">FT</option>
                            <option value="cm">CM</option>
                            <option value="mtr">MTR</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">Quantity</label>
                    <input type="number" class="input-field" id="quantity" value="25" step="1">
                </div>
                
                <div class="input-group">
                    <label class="input-label">Allow Rotation</label>
                    <div class="checkbox-group">
                        <div class="checkbox checked" id="allowRotation"></div>
                        <span style="color: var(--text-gray); font-size: 10px;">ENABLE ROTATION OPTIMIZATION</span>
                    </div>
                </div>
                
                <button class="calculate-btn" onclick="calculate()">CALCULATE LAYOUT</button>
            </div>
            
            <!-- Layout Results with Simple Visualizer -->
            <div class="panel">
                <div class="panel-title">Layout Results & Preview</div>
                
                <!-- Simple Visualizer -->
                <div style="margin-bottom: 16px; background: var(--input-bg); border: 1px solid var(--border-gray); padding: 12px;">
                    <div style="font-size: 9px; color: var(--text-gray); margin-bottom: 8px; text-transform: uppercase; display: flex; justify-content: space-between; align-items: center;">
                        <span>Quick Preview</span>
                        <a href="#" onclick="openVisualizer()" style="background: var(--accent-blue); color: var(--bg-black); padding: 4px 8px; text-decoration: none; font-size: 9px; font-weight: bold;">DETAILED VIEW â†’</a>
                    </div>
                    <div id="visualizer" style="position: relative; background: var(--text-dark-gray); border: 1px solid var(--border-gray); min-height: 100px; overflow: auto;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--text-gray); font-size: 10px;">
                            ENTER VALUES TO SEE LAYOUT
                        </div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 9px; color: var(--text-gray);">
                        <span>ROLL WIDTH</span>
                        <span id="visualizerScale">SCALE: 1:10</span>
                        <span>ROLL LENGTH</span>
                    </div>
                </div>
                
                <!-- Results -->
                <div id="layoutResults">
                    <div class="result-row" onclick="copyToClipboard('bestOrientation')">
                        <span class="result-label">Best Orientation</span>
                        <span class="result-value highlight" id="bestOrientation">-</span>
                    </div>
                    <div class="result-row" onclick="copyToClipboard('designsPerRow')">
                        <span class="result-label">Designs per Row</span>
                        <span class="result-value" id="designsPerRow">-</span>
                    </div>
                    <div class="result-row" onclick="copyToClipboard('rowsNeeded')">
                        <span class="result-label">Rows Needed</span>
                        <span class="result-value" id="rowsNeeded">-</span>
                    </div>
                    <div class="result-row" onclick="copyToClipboard('rollLength')">
                        <span class="result-label">Roll Length (in)</span>
                        <span class="result-value" id="rollLength">-</span>
                    </div>
                    <div class="result-row" onclick="copyToClipboard('usedArea')">
                        <span class="result-label">Used Area (sq in)</span>
                        <span class="result-value" id="usedArea">-</span>
                    </div>
                    <div class="result-row" onclick="copyToClipboard('consumedArea')">
                        <span class="result-label">Consumed Area (sq in)</span>
                        <span class="result-value" id="consumedArea">-</span>
                    </div>
                    <div class="result-row" onclick="copyToClipboard('wastagePercent')">
                        <span class="result-label">Layout Wastage</span>
                        <span class="result-value highlight" id="wastagePercent">-</span>
                    </div>
                </div>
            </div>

            <!-- Cost Calculator -->
            <div class="panel">
                <div class="panel-title">Cost Calculator</div>
                
                <div class="input-group">
                    <label class="input-label">Material Cost</label>
                    <div style="display: flex; gap: 8px;">
                        <span style="color: var(--text-gray); font-size: 11px; align-self: center;">MVR</span>
                        <input type="number" class="input-field" id="materialCost" value="38.50" step="0.01" style="flex: 1;">
                        <select class="input-field" id="materialCostUnit" style="width: 80px;">
                            <option value="sqft">SQ FT</option>
                            <option value="sqmtr">SQ MTR</option>
                            <option value="sqin">SQ IN</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">Ink Cost</label>
                    <div style="display: flex; gap: 8px;">
                        <span style="color: var(--text-gray); font-size: 11px; align-self: center;">MVR</span>
                        <input type="number" class="input-field" id="inkCost" value="13.10" step="0.01" style="flex: 1;">
                        <select class="input-field" id="inkCostUnit" style="width: 80px;">
                            <option value="sqft">SQ FT</option>
                            <option value="sqmtr">SQ MTR</option>
                            <option value="sqin">SQ IN</option>
                        </select>
                    </div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">Setup/Labor Cost (MVR)</label>
                    <input type="number" class="input-field" id="setupCost" value="693.75" step="0.01">
                </div>
                
                <div class="input-group">
                    <label class="input-label">Additional Wastage (%)</label>
                    <input type="number" class="input-field" id="additionalWastage" value="5" step="0.1" title="Safety margin for cutting errors, reprints, material defects">
                    <div style="font-size: 9px; color: var(--text-gray); margin-top: 4px;">
                        SAFETY MARGIN: CUTTING ERRORS, REPRINTS, DEFECTS
                    </div>
                </div>
                
                <div class="input-group">
                    <label class="input-label">Desired Markup (%)</label>
                    <input type="number" class="input-field" id="markup" value="40" step="0.1">
                </div>
                
                <button class="calculate-btn" onclick="calculate()">CALCULATE COSTS</button>
            </div>
            
            <!-- Cost Results -->
            <div class="panel">
                <div class="panel-title">Cost Results</div>
                <div id="costResults">
                    <div class="result-row" onclick="copyToClipboard('totalWastage')">
                        <span class="result-label">Total Wastage</span>
                        <span class="result-value" id="totalWastage">-</span>
                    </div>
                    <div class="result-row" onclick="copyToClipboard('materialArea')">
                        <span class="result-label">Material Area (sq ft)</span>
                        <span class="result-value" id="materialArea">-</span>
                    </div>
                    <div class="result-row" onclick="copyToClipboard('totalMaterialCost')">
                        <span class="result-label">Material Cost</span>
                        <span class="result-value" id="totalMaterialCost">-</span>
                    </div>
                    <div class="result-row" onclick="copyToClipboard('totalInkCost')">
                        <span class="result-label">Ink Cost</span>
                        <span class="result-value" id="totalInkCost">-</span>
                    </div>
                    <div class="result-row" onclick="copyToClipboard('totalJobCost')">
                        <span class="result-label">Total Job Cost</span>
                        <span class="result-value highlight" id="totalJobCost">-</span>
                    </div>
                    <div class="result-row" onclick="copyToClipboard('costPerUnit')">
                        <span class="result-label">Cost per Unit</span>
                        <span class="result-value" id="costPerUnit">-</span>
                    </div>
                    <div class="result-row" onclick="copyToClipboard('sellingPrice')">
                        <span class="result-label">Selling Price/Unit</span>
                        <span class="result-value highlight" id="sellingPrice">-</span>
                    </div>
                    <div class="result-row" onclick="copyToClipboard('totalSellingPrice')">
                        <span class="result-label">Total Selling Price</span>
                        <span class="result-value highlight" id="totalSellingPrice">-</span>
                    </div>
                    <div class="result-row" onclick="copyToClipboard('totalProfit')">
                        <span class="result-label">Total Profit</span>
                        <span class="result-value highlight" id="totalProfit">-</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <div>CANVAS PRINT CALCULATOR v1.0</div>
            <div>CLICK ANY RESULT TO COPY</div>
            <div>LAST CALC: <span id="lastCalc">-</span></div>
        </div>
    </div>
    
    <div class="copy-feedback" id="copyFeedback">COPIED TO CLIPBOARD</div>
    
    <script>
        // Update time and date
        function updateTime() {
            const now = new Date();
            const timeElement = document.getElementById('current-time');
            const dateElement = document.getElementById('current-date');
            
            const hours = String(now.getUTCHours()).padStart(2, '0');
            const minutes = String(now.getUTCMinutes()).padStart(2, '0');
            timeElement.textContent = `${hours}:${minutes} GMT`;
            
            const day = String(now.getUTCDate()).padStart(2, '0');
            const month = ['JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG','SEP','OCT','NOV','DEC'][now.getUTCMonth()];
            const year = now.getUTCFullYear();
            dateElement.textContent = `${day}-${month}-${year}`;
        }
        
        setInterval(updateTime, 1000);
        updateTime();
        
        // Checkbox handling
        document.getElementById('allowRotation').addEventListener('click', function() {
            this.classList.toggle('checked');
        });
        
        let designCounter = 0;
        let designs = [];
        
        function addDesignRow() {
            designCounter++;
            const designRows = document.getElementById('designRows');
            
            const row = document.createElement('div');
            row.className = 'design-row';
            row.id = `design-${designCounter}`;
            
            row.innerHTML = `
                <div style="display: flex; gap: 4px;">
                    <input type="number" class="input-field" placeholder="Width" step="0.1" value="16" style="flex: 1;" onchange="updateDesigns()">
                    <select class="input-field" style="width: 50px;" onchange="updateDesigns()">
                        <option value="inch">IN</option>
                        <option value="ft">FT</option>
                        <option value="cm">CM</option>
                        <option value="mtr">M</option>
                    </select>
                </div>
                <div style="display: flex; gap: 4px;">
                    <input type="number" class="input-field" placeholder="Height" step="0.1" value="20" style="flex: 1;" onchange="updateDesigns()">
                    <select class="input-field" style="width: 50px;" onchange="updateDesigns()">
                        <option value="inch">IN</option>
                        <option value="ft">FT</option>
                        <option value="cm">CM</option>
                        <option value="mtr">M</option>
                    </select>
                </div>
                <input type="number" class="input-field" placeholder="Qty" step="1" value="5" min="1" onchange="updateDesigns()">
                <input type="text" class="input-field" placeholder="Label" value="Design ${designCounter}" onchange="updateDesigns()">
                <button class="remove-btn" onclick="removeDesignRow('design-${designCounter}')" title="Remove">Ã—</button>
            `;
            
            designRows.appendChild(row);
            updateDesigns();
        }
        
        function removeDesignRow(id) {
            const row = document.getElementById(id);
            if (row) {
                row.remove();
                updateDesigns();
            }
        }
        
        function updateDesigns() {
            designs = [];
            const designRows = document.querySelectorAll('.design-row');
            
            designRows.forEach((row, index) => {
                const inputs = row.querySelectorAll('input');
                const selects = row.querySelectorAll('select');
                
                if (inputs.length >= 4 && selects.length >= 2) {
                    const width = parseFloat(inputs[0].value) || 0;
                    const widthUnit = selects[0].value;
                    const height = parseFloat(inputs[1].value) || 0;
                    const heightUnit = selects[1].value;
                    const quantity = parseInt(inputs[2].value) || 0;
                    const label = inputs[3].value || `Design ${index + 1}`;
                    
                    if (width > 0 && height > 0 && quantity > 0) {
                        designs.push({
                            width: convertToInches(width, widthUnit),
                            height: convertToInches(height, heightUnit),
                            quantity: quantity,
                            label: label,
                            originalWidth: width,
                            originalHeight: height,
                            widthUnit: widthUnit,
                            heightUnit: heightUnit
                        });
                    }
                }
            });
            
            calculate();
        }
        
        // Auto-calculate on input change
        document.querySelectorAll('.input-field, select').forEach(input => {
            input.addEventListener('input', calculate);
            input.addEventListener('change', calculate);
        });
        
        // Initialize with one design row
        document.addEventListener('DOMContentLoaded', function() {
            addDesignRow();
        });
        
        // Unit conversion functions
        function convertToInches(value, unit) {
            const conversions = {
                'inch': 1,
                'ft': 12,
                'cm': 0.393701,
                'mtr': 39.3701
            };
            return value * conversions[unit];
        }
        
        function convertToSqFt(value, unit) {
            const conversions = {
                'sqft': 1,
                'sqmtr': 10.7639,
                'sqin': 1/144
            };
            return value * conversions[unit];
        }
        
        function formatCurrency(amount) {
            return 'MVR ' + amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }
        
        function updateVisualizer(rollWidth, layoutResult) {
            const visualizer = document.getElementById('visualizer');
            const scale = document.getElementById('visualizerScale');
            
            // Clear previous content
            visualizer.innerHTML = '';
            
            if (!rollWidth || !layoutResult || layoutResult.sections.length === 0) {
                visualizer.innerHTML = '<div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: var(--text-gray); font-size: 10px;">ENTER VALUES TO SEE LAYOUT</div>';
                return;
            }
            
            // Calculate scale to fit in small visualizer (280px wide max)
            const maxWidth = 260;
            const scaleRatio = maxWidth / rollWidth;
            const scaledRollWidth = rollWidth * scaleRatio;
            const scaledRollLength = layoutResult.totalLength * scaleRatio;
            const maxHeight = Math.min(scaledRollLength, 80); // Small height for preview
            
            // If roll is too long, adjust scale
            let finalScale = scaleRatio;
            let finalRollWidth = scaledRollWidth;
            let finalRollLength = scaledRollLength;
            
            if (scaledRollLength > 80) {
                finalScale = 80 / layoutResult.totalLength;
                finalRollWidth = rollWidth * finalScale;
                finalRollLength = 80;
            }
            
            // Set visualizer dimensions
            visualizer.style.width = finalRollWidth + 'px';
            visualizer.style.height = finalRollLength + 'px';
            visualizer.style.position = 'relative';
            visualizer.style.margin = '0 auto';
            visualizer.style.background = '#2c2c2c';
            
            let currentY = 0;
            
            // Draw simplified sections
            layoutResult.sections.forEach((section, sectionIndex) => {
                const sectionColor = ['#00cc00', '#00aacc', '#cc9900'][sectionIndex % 3];
                const sectionHeight = section.rowsNeeded * section.scaledRowHeight * finalScale;
                
                // Draw section as simple colored rectangle
                const sectionRect = document.createElement('div');
                sectionRect.style.position = 'absolute';
                sectionRect.style.left = '0px';
                sectionRect.style.top = currentY + 'px';
                sectionRect.style.width = finalRollWidth + 'px';
                sectionRect.style.height = sectionHeight + 'px';
                sectionRect.style.background = sectionColor + '40';
                sectionRect.style.border = '1px solid ' + sectionColor;
                sectionRect.style.boxSizing = 'border-box';
                
                // Add section label if big enough
                if (sectionHeight > 12) {
                    const label = document.createElement('div');
                    label.style.position = 'absolute';
                    label.style.top = '2px';
                    label.style.left = '2px';
                    label.style.color = sectionColor;
                    label.style.fontSize = '8px';
                    label.style.fontWeight = 'bold';
                    label.textContent = `${section.design.quantity}x`;
                    sectionRect.appendChild(label);
                }
                
                visualizer.appendChild(sectionRect);
                currentY += sectionHeight;
            });
            
            // Update scale indicator
            const actualScale = Math.round(1 / finalScale);
            scale.textContent = `SCALE: 1:${actualScale}`;
            
            // Add click hint
            const hint = document.createElement('div');
            hint.style.position = 'absolute';
            hint.style.bottom = '2px';
            hint.style.right = '2px';
            hint.style.fontSize = '7px';
            hint.style.color = 'var(--text-gray)';
            hint.style.background = 'rgba(0, 0, 0, 0.7)';
            hint.style.padding = '1px 3px';
            hint.textContent = 'CLICK FOR DETAILS';
            visualizer.appendChild(hint);
        }
        
        function calculate() {
            // Get input values and convert to standard units (inches for dimensions, sq ft for costs)
            const rollWidth = convertToInches(parseFloat(document.getElementById('rollWidth').value) || 0, 
                                            document.getElementById('rollWidthUnit').value);
            const designWidth = convertToInches(parseFloat(document.getElementById('designWidth').value) || 0, 
                                               document.getElementById('designWidthUnit').value);
            const designHeight = convertToInches(parseFloat(document.getElementById('designHeight').value) || 0, 
                                                document.getElementById('designHeightUnit').value);
            const quantity = parseInt(document.getElementById('quantity').value) || 0;
            const allowRotation = document.getElementById('allowRotation').classList.contains('checked');
            
            const materialCostPerSqFt = convertToSqFt(parseFloat(document.getElementById('materialCost').value) || 0, 
                                                     document.getElementById('materialCostUnit').value);
            const inkCostPerSqFt = convertToSqFt(parseFloat(document.getElementById('inkCost').value) || 0, 
                                                document.getElementById('inkCostUnit').value);
            const setupCost = parseFloat(document.getElementById('setupCost').value) || 0;
            const additionalWastage = parseFloat(document.getElementById('additionalWastage').value) / 100 || 0;
            const markup = parseFloat(document.getElementById('markup').value) / 100 || 0;
            
            // Layout calculations
            const designsPerRowNormal = Math.floor(rollWidth / designWidth);
            const designsPerRowRotated = allowRotation ? Math.floor(rollWidth / designHeight) : 0;
            
            const materialPerDesignNormal = designsPerRowNormal > 0 ? (rollWidth * designHeight) / designsPerRowNormal : 999999;
            const materialPerDesignRotated = designsPerRowRotated > 0 ? (rollWidth * designWidth) / designsPerRowRotated : 999999;
            
            const bestOrientation = materialPerDesignNormal <= materialPerDesignRotated ? 'NORMAL' : 'ROTATED';
            const optimalDesignsPerRow = bestOrientation === 'NORMAL' ? designsPerRowNormal : designsPerRowRotated;
            const rowHeight = bestOrientation === 'NORMAL' ? designHeight : designWidth;
            
            const rowsNeeded = Math.ceil(quantity / optimalDesignsPerRow);
            const rollLength = rowsNeeded * rowHeight;
            const usedArea = quantity * designWidth * designHeight;
            const consumedArea = rollWidth * rollLength;
            const layoutWastage = (consumedArea - usedArea) / consumedArea;
            
            // Cost calculations
            const totalWastagePercent = layoutWastage + additionalWastage;
            const materialAreaSqFt = (usedArea / 144) * (1 + totalWastagePercent);
            const totalMaterialCost = materialAreaSqFt * materialCostPerSqFt;
            const totalInkCost = materialAreaSqFt * inkCostPerSqFt;
            const totalJobCost = totalMaterialCost + totalInkCost + setupCost;
            const costPerUnit = totalJobCost / quantity;
            const sellingPricePerUnit = costPerUnit * (1 + markup);
            const totalSellingPrice = sellingPricePerUnit * quantity;
            const totalProfit = totalSellingPrice - totalJobCost;
            
            // Update results
            document.getElementById('bestOrientation').textContent = bestOrientation;
            document.getElementById('designsPerRow').textContent = optimalDesignsPerRow;
            document.getElementById('rowsNeeded').textContent = rowsNeeded;
            document.getElementById('rollLength').textContent = rollLength.toFixed(1) + '"';
            document.getElementById('usedArea').textContent = usedArea.toLocaleString();
            document.getElementById('consumedArea').textContent = consumedArea.toLocaleString();
            document.getElementById('wastagePercent').textContent = (layoutWastage * 100).toFixed(1) + '%';
            
            document.getElementById('totalWastage').textContent = (totalWastagePercent * 100).toFixed(1) + '%';
            document.getElementById('materialArea').textContent = materialAreaSqFt.toFixed(2);
            document.getElementById('totalMaterialCost').textContent = formatCurrency(totalMaterialCost);
            document.getElementById('totalInkCost').textContent = formatCurrency(totalInkCost);
            document.getElementById('totalJobCost').textContent = formatCurrency(totalJobCost);
            document.getElementById('costPerUnit').textContent = formatCurrency(costPerUnit);
            document.getElementById('sellingPrice').textContent = formatCurrency(sellingPricePerUnit);
            document.getElementById('totalSellingPrice').textContent = formatCurrency(totalSellingPrice);
            document.getElementById('totalProfit').textContent = formatCurrency(totalProfit);
            
            // Update visualizer
            updateVisualizer(rollWidth, designWidth, designHeight, quantity, bestOrientation, optimalDesignsPerRow, rowsNeeded, rollLength);
            
            // Update last calculation time
            const now = new Date();
            const timeStr = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            document.getElementById('lastCalc').textContent = timeStr;
        }
        
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(function() {
                showCopyFeedback();
            }).catch(function() {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showCopyFeedback();
            });
        }
        
        function showCopyFeedback() {
            const feedback = document.getElementById('copyFeedback');
            feedback.classList.add('show');
            setTimeout(() => {
                feedback.classList.remove('show');
            }, 1500);
        }
        
        function openVisualizer() {
            // For now, open in a new tab with a placeholder message
            // In production, this would link to visualizer.html
            const newWindow = window.open('', '_blank');
            newWindow.document.write(`
                <html>
                <head><title>Visualizer</title></head>
                <body style="font-family: monospace; background: #000; color: #fff; padding: 20px;">
                    <h2>ðŸš§ DETAILED VISUALIZER</h2>
                    <p>To set up the detailed visualizer:</p>
                    <ol>
                        <li>Save the "Canvas Print Layout Visualizer" artifact as <strong>visualizer.html</strong></li>
                        <li>Upload both index.html and visualizer.html to your GitHub repository</li>
                        <li>The link will work automatically once both files are deployed</li>
                    </ol>
                    <p>Current design data would be passed to the visualizer for full-scale layout preview.</p>
                    <button onclick="window.close()" style="background: #cc0000; color: #fff; border: none; padding: 8px 16px; margin-top: 20px;">Close</button>
                </body>
                </html>
            `);
        }
        
        // Initial calculation
        calculate();
    </script>
</body>
</html>
